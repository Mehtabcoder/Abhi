<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>VOID - The True Horror</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Courier New', monospace; }
        #overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center;
            align-items: center; background: black; color: #600; z-index: 10; cursor: pointer;
        }
        #jumpscare {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; display: none; z-index: 100;
            justify-content: center; align-items: center;
        }
        #jumpscare img { width: 100%; height: 100%; object-fit: cover; filter: contrast(200%) grayscale(100%) invert(100%); }
        
        /* Screen Shake Animation */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            50% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        .shaking { animation: shake 0.1s infinite; }
    </style>
</head>
<body>

    <div id="overlay">
        <h1>VOID</h1>
        <p style="color: #444;">PUT ON HEADPHONES</p>
        <p>CLICK TO START</p>
    </div>

    <div id="jumpscare">
        <div style="width:100%; height:100%; background: radial-gradient(circle, #fff 0%, #000 70%); opacity: 0.8;"></div>
        <h1 style="position:absolute; color:red; font-size: 10vw;">WATCHING</h1>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';

        let scene, camera, renderer, controls, flashlight, stalker;
        let moveForward = false, moveBackward = false, moveLeft = false, moveRight = false;
        let velocity = new THREE.Vector3();
        let direction = new THREE.Vector3();
        let audioCtx, heartbeat, jumpscareSound;
        let isGameOver = false;

        const overlay = document.getElementById('overlay');
        const jumpscareDiv = document.getElementById('jumpscare');

        // --- 1. Audio Setup (Synthetic Horror Sounds) ---
        function initAudio() {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            
            // Heartbeat
            heartbeat = audioCtx.createOscillator();
            const gainH = audioCtx.createGain();
            heartbeat.type = 'sine';
            heartbeat.frequency.value = 60;
            gainH.gain.value = 0;
            heartbeat.connect(gainH);
            gainH.connect(audioCtx.destination);
            heartbeat.start();

            // Heartbeat Pulse
            setInterval(() => {
                if(controls.isLocked) {
                    gainH.gain.setValueAtTime(0.5, audioCtx.currentTime);
                    gainH.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                }
            }, 800);
        }

        function playScream() {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(3000, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 1);
            gain.gain.setValueAtTime(1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 1);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
        }

        // --- 2. Scene Setup ---
        function init() {
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x000000, 0.15);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.y = 1.6;

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Flashlight
            flashlight = new THREE.SpotLight(0xffffff, 50, 25, Math.PI/6, 0.5, 2);
            camera.add(flashlight);
            flashlight.position.set(0, 0, 0.1);
            flashlight.target = new THREE.Object3D();
            camera.add(flashlight.target);
            flashlight.target.position.set(0, 0, -1);
            scene.add(camera);

            // Ground & Walls (Procedural Maze-like)
            const floor = new THREE.Mesh(
                new THREE.PlaneGeometry(200, 200),
                new THREE.MeshStandardMaterial({ color: 0x050505 })
            );
            floor.rotation.x = -Math.PI / 2;
            scene.add(floor);

            // Distant creepy pillars
            for(let i=0; i<100; i++) {
                const wall = new THREE.Mesh(
                    new THREE.BoxGeometry(2, 10, 2),
                    new THREE.MeshStandardMaterial({ color: 0x111111 })
                );
                wall.position.set(Math.random()*100-50, 5, Math.random()*100-50);
                scene.add(wall);
            }

            // --- THE STALKER ---
            const stalkerGeo = new THREE.BoxGeometry(0.5, 2, 0.5);
            const stalkerMat = new THREE.MeshBasicMaterial({ color: 0x000000 });
            stalker = new THREE.Mesh(stalkerGeo, stalkerMat);
            stalker.position.set(0, 1, -20);
            scene.add(stalker);

            controls = new PointerLockControls(camera, document.body);
            overlay.addEventListener('click', () => {
                if(!audioCtx) initAudio();
                controls.lock();
            });

            controls.addEventListener('lock', () => overlay.style.display = 'none');
            controls.addEventListener('unlock', () => overlay.style.display = 'flex');

            document.addEventListener('keydown', (e) => {
                if(e.code==='KeyW') moveForward=true;
                if(e.code==='KeyS') moveBackward=true;
                if(e.code==='KeyA') moveLeft=true;
                if(e.code==='KeyD') moveRight=true;
            });
            document.addEventListener('keyup', (e) => {
                if(e.code==='KeyW') moveForward=false;
                if(e.code==='KeyS') moveBackward=false;
                if(e.code==='KeyA') moveLeft=false;
                if(e.code==='KeyD') moveRight=false;
            });
        }

        function triggerJumpscare() {
            isGameOver = true;
            playScream();
            document.body.classList.add('shaking');
            jumpscareDiv.style.display = 'flex';
            
            setTimeout(() => {
                location.reload(); // Restart game after shock
            }, 1500);
        }

        function animate() {
            requestAnimationFrame(animate);
            if (!controls.isLocked || isGameOver) return;

            // 1. Movement logic
            const delta = 0.015;
            velocity.x -= velocity.x * 10.0 * delta;
            velocity.z -= velocity.z * 10.0 * delta;
            direction.z = Number(moveForward) - Number(moveBackward);
            direction.x = Number(moveRight) - Number(moveLeft);
            direction.normalize();
            if (moveForward || moveBackward) velocity.z -= direction.z * 400.0 * delta;
            if (moveLeft || moveRight) velocity.x -= direction.x * 400.0 * delta;
            controls.moveRight(-velocity.x * delta);
            controls.moveForward(-velocity.z * delta);

            // 2. Flashlight Flickering
            if (Math.random() > 0.98) {
                flashlight.intensity = 0; // Total darkness for a frame
            } else {
                flashlight.intensity = 60 + Math.random() * 20;
            }

            // 3. Stalker Logic (Closer when you look away)
            const dist = camera.position.distanceTo(stalker.position);
            
            // If monster is far, move it closer randomly
            if (dist > 2) {
                stalker.lookAt(camera.position.x, 1, camera.position.z);
                stalker.translateZ(0.03); 
            } else {
                triggerJumpscare();
            }

            // 4. Subtle screen shake if monster is near
            if (dist < 8) {
                renderer.domElement.style.filter = `contrast(${100 + (10/dist)*50}%) brightness(${1 - 1/dist})`;
            }

            renderer.render(scene, camera);
        }

        init();
        animate();
    </script>
</body>
</html>